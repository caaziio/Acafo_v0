{% extends "layout.html" %}

{% block title %}Authenticating... - Resume Builder{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
            <div class="text-center">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">
                    Authenticating...
                </h2>
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                <p class="text-gray-600">
                    Please wait while we complete your authentication...
                </p>
            </div>
        </div>
    </div>
</div>

<script>
// Extract token from URL fragment and redirect to callback
(function() {
    const hash = window.location.hash;
    if (hash) {
        // Parse the hash fragment
        const params = new URLSearchParams(hash.substring(1));
        const accessToken = params.get('access_token');
        const tokenType = params.get('token_type');
        
        if (accessToken && tokenType === 'bearer') {
                    // Always redirect to localhost:3000 (our Flask app) with token as query parameter
        const callbackUrl = 'http://localhost:3000/auth/callback';
            const finalUrl = `${callbackUrl}?access_token=${encodeURIComponent(accessToken)}&token_type=${encodeURIComponent(tokenType)}`;
            
            // Redirect to the callback with the token
            window.location.href = finalUrl;
        } else {
            // No valid token found, redirect to login
            window.location.href = 'http://localhost:3000/login';
        }
    } else {
        // No hash fragment, redirect to login
        window.location.href = 'http://localhost:3000/login';
    }
})();
</script>
{% endblock %}
