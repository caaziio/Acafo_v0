{% extends "layout.html" %}
{% block title %}Follow-Up Questions{% endblock %}
{% block page_title %}Follow-Up Questions{% endblock %}
{% block content %}

<section class="hero">
  <div>
    <h2 style="margin:0 0 8px; font-size:1.5rem; font-weight:700">Answer 3 quick questions to sharpen your bullets</h2>
    <p style="margin:0; font-size:.95rem; opacity:0.9">Your answers will help us create more impactful resume points</p>
  </div>
  <div class="inline-flex items-center gap-2 bg-white text-blue-800 px-4 py-2 rounded-full font-medium">
    <span>Question {{ current_index + 1 }} of 3</span>
  </div>
</section>

<!-- Progress Indicator -->
<section class="card">
  <h3>Progress</h3>
  <div class="text-center mb-4">
    <div class="w-full bg-gray-200 rounded-full h-3">
      <div class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: {{ ((current_index + 1) / 3) * 100 }}%"></div>
    </div>
    <div class="text-sm text-gray-600 mt-3">
      {{ current_index + 1 }} of 3 questions completed
    </div>
  </div>
</section>

<!-- Experience Block (Read-only) -->
<section class="card">
  <h3>Your Experience</h3>
  <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
    <p class="text-gray-700 text-base leading-relaxed">{{ experience.text }}</p>
  </div>
</section>

<!-- Initial Bullet Points -->
<section class="card">
  <h3>Initial Resume Bullet Points</h3>
  <div class="bg-blue-50 rounded-lg p-6 border border-blue-200">
    <ul class="list-disc list-inside text-base text-gray-800 space-y-3">
      {% if experience.initial_bullets %}
        {% if experience.initial_bullets is string %}
          {% for line in experience.initial_bullets.split('\n') %}
            {% set clean_line = line.replace('**', '') %}
            {% if clean_line.strip() != '' %}
              <li class="text-gray-700">{{ clean_line }}</li>
            {% endif %}
          {% endfor %}
        {% else %}
          {% for bullet in experience.initial_bullets %}
            <li class="text-gray-700">{{ bullet.replace('**', '') }}</li>
          {% endfor %}
        {% endif %}
      {% else %}
        <li class="text-gray-500 italic">No bullet points available</li>
      {% endif %}
    </ul>
  </div>
</section>

<!-- Current Question -->
<section class="card">
  <h3>Question {{ current_index + 1 }}</h3>
  <p class="text-gray-800 text-lg mb-6 font-medium">{{ current_question }}</p>

  {% if error %}
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
      <p class="text-red-700 font-medium">{{ error }}</p>
    </div>
  {% endif %}

  <form method="POST">
    <div class="mb-6">
      <label for="answer" class="block text-sm font-semibold text-gray-700 mb-3">Your answer:</label>
      <textarea 
        name="answer" 
        id="answer" 
        rows="5" 
        placeholder="Type your answer here..."
        class="w-full p-4 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base resize-none transition-all"
        required
      >{% if answer_text %}{{ answer_text | e }}{% endif %}</textarea>
      
      <!-- Character counter for answer -->
      <div class="text-sm text-gray-500 mt-3 text-right">
        <span id="answerCharCount">{{ answer_text | length if answer_text else 0 }}</span> / 500 characters
      </div>
    </div>

    <div class="flex justify-end items-center">
      <button 
        type="submit" 
        class="next-question-btn">
        <span class="btn-content">
          {% if current_index == 2 %}
            <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            <span>Finish & Generate Final Bullets</span>
            <svg class="btn-arrow" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          {% else %}
            <span>Next Question</span>
            <svg class="btn-arrow" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
            </svg>
          {% endif %}
        </span>
        <div class="btn-overlay"></div>
      </button>
    </div>
  </form>
</section>

{% endblock %}

{% block extra_styles %}
<style>
  .next-question-btn {
    position: relative;
    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
    color: white;
    font-weight: 700;
    font-size: 1.125rem;
    padding: 18px 36px;
    border: none;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3), 0 4px 12px rgba(124, 58, 237, 0.2);
    cursor: pointer;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 220px;
    border: 2px solid transparent;
    backdrop-filter: blur(10px);
  }

  .next-question-btn:hover {
    transform: translateY(-3px) scale(1.03);
    box-shadow: 0 20px 40px rgba(37, 99, 235, 0.4), 0 8px 20px rgba(124, 58, 237, 0.3);
    background: linear-gradient(135deg, #1d4ed8 0%, #6d28d9 100%);
    border-color: rgba(255, 255, 255, 0.2);
  }

  .next-question-btn:active {
    transform: translateY(-1px) scale(0.99);
    transition: all 0.15s ease;
  }

  .next-question-btn:focus {
    outline: none;
    ring: 4px solid rgba(37, 99, 235, 0.3);
  }

  .btn-content {
    position: relative;
    z-index: 3;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    letter-spacing: 0.5px;
  }

  .btn-icon, .btn-arrow {
    width: 22px;
    height: 22px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }

  .next-question-btn:hover .btn-arrow {
    transform: translateX(6px) scale(1.15) rotate(3deg);
  }

  .next-question-btn:hover .btn-icon {
    transform: scale(1.15) rotate(-3deg);
  }

  .btn-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
    border-radius: 16px;
    z-index: 1;
  }

  .next-question-btn:hover .btn-overlay {
    opacity: 1;
  }

  /* Enhanced shimmer effect */
  .next-question-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.8s;
    z-index: 2;
    border-radius: 16px;
  }

  .next-question-btn:hover::before {
    left: 100%;
  }

  /* Subtle pulse animation for engagement */
  .next-question-btn::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 18px;
    background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
    opacity: 0;
    z-index: -1;
    animation: gentle-pulse 3s infinite;
  }

  @keyframes gentle-pulse {
    0%, 100% {
      opacity: 0;
      transform: scale(1);
    }
    50% {
      opacity: 0.2;
      transform: scale(1.02);
    }
  }

  /* Finish button special styling */
  .next-question-btn:has(.btn-icon) {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3), 0 4px 12px rgba(5, 150, 105, 0.2);
  }

  .next-question-btn:has(.btn-icon):hover {
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
    box-shadow: 0 20px 40px rgba(16, 185, 129, 0.4), 0 8px 20px rgba(5, 150, 105, 0.3);
  }

  .next-question-btn:has(.btn-icon)::after {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .next-question-btn {
      font-size: 1rem;
      padding: 16px 28px;
      min-width: 200px;
      border-radius: 14px;
    }
    
    .btn-icon, .btn-arrow {
      width: 20px;
      height: 20px;
    }
  }

  @media (max-width: 480px) {
    .next-question-btn {
      font-size: 0.95rem;
      padding: 14px 24px;
      min-width: 180px;
      border-radius: 12px;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .next-question-btn {
      border: 3px solid white;
      box-shadow: none;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .next-question-btn,
    .btn-content,
    .btn-icon,
    .btn-arrow,
    .btn-overlay {
      transition: none;
    }
    
    .next-question-btn::before,
    .next-question-btn::after {
      animation: none;
    }
  }
</style>
{% endblock %}

{% block extra_scripts %}
<script>
  // Character counter for answer textarea
  const answerTextarea = document.getElementById('answer');
  const answerCharCount = document.getElementById('answerCharCount');
  
  answerTextarea.addEventListener('input', function() {
    const length = this.value.length;
    answerCharCount.textContent = length;
    
    // Change color based on length
    if (length > 450) {
      answerCharCount.className = 'text-sm text-red-500 mt-3 text-right';
    } else if (length > 400) {
      answerCharCount.className = 'text-sm text-orange-500 mt-3 text-right';
    } else {
      answerCharCount.className = 'text-sm text-gray-500 mt-3 text-right';
    }
  });
</script>
{% endblock %}